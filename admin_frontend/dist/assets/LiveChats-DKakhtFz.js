import{_ as Y,u as P,g as p,i as h,w as A,h as G,c as i,o as n,b as e,t as c,j as L,F as N,C as q,D as J,p as Z,d as y,k as w,n as _,a as ee,l as te,v as se,G as E,y as H,B as K,z as ae,s as oe}from"./index-xh6Kq0Kr.js";import{X as O}from"./x-98jOyHBR.js";import{M as Q}from"./message-circle-Cfwst8Sj.js";import{S as re}from"./send-D-TwDna5.js";import{I as le}from"./info-uzTUgB86.js";import{R as ne}from"./radio-DPjS--pG.js";import{R as ie}from"./refresh-cw-C8u3WmF2.js";import"./createLucideIcon-BvNgPl9c.js";const de={class:"bg-gradient-to-br from-slate-800/90 via-slate-900/90 to-black/90 backdrop-blur-xl rounded-2xl border border-slate-700/50 overflow-hidden flex flex-col shadow-2xl h-[75vh]"},ce={class:"px-4 py-3 bg-gradient-to-r from-slate-900/80 via-slate-800/80 to-slate-900/80 backdrop-blur-md border-b border-slate-700/50"},ue={class:"flex items-center justify-between"},he={class:"flex items-center gap-3"},pe={class:"font-bold text-sm text-white"},fe={class:"text-xs text-slate-400"},ge={class:"bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-600/30 text-blue-400 text-xs px-2 py-1 rounded-full font-medium"},ve={key:0,class:"text-center"},me={class:"text-xs text-slate-400 bg-slate-800/60 backdrop-blur-sm rounded-full px-3 py-1 border border-slate-600/30 inline-block"},be={key:1,class:"text-center relative"},xe={class:"text-xs text-yellow-400 bg-yellow-900/20 backdrop-blur-sm rounded-full px-3 py-1 border border-yellow-600/30 inline-block"},_e=["onClick"],ye={class:"w-7 h-7 rounded-lg overflow-hidden flex-shrink-0 bg-slate-700 border border-slate-600/50"},we=["src","alt"],ke={key:1,class:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-500 text-white text-xs font-bold"},Ce={class:"text-xs text-slate-500"},Se=["onClick"],Me={key:0,class:"flex items-center gap-2 text-slate-400 text-xs"},De={key:1,class:"text-center py-8"},$e={class:"text-slate-500 text-xs"},Te={class:"p-3 border-t border-slate-700/50 bg-gradient-to-r from-slate-900/80 via-slate-800/80 to-slate-900/80"},Le={class:"flex gap-2"},Fe=["onKeydown"],Ue=["disabled"],Ie={class:"mt-2 flex items-center gap-1"},je={class:"text-xs text-slate-500"},ze={__name:"LiveChatCard",props:{stationData:{type:Object,required:!0}},setup(C){const d=C,f=P(),g=p(null),b=p(""),v=p(!1),S=p(null),z=p(0),k=h(()=>(f.getters.livechatmessages||[]).filter(t=>t.station_id===d.stationData.id&&t.is_visible).sort((t,s)=>new Date(t.created_at)-new Date(s.created_at)).slice(-50)),u=h(()=>f.getters.authuser),M=h(()=>u.value&&u.value.id&&b.value.trim().length>0),m=o=>u.value&&o.user_id===u.value.id,$=o=>{const t=o.target;t.style.height="auto",t.style.height=Math.min(t.scrollHeight,128)+"px",R()},F=o=>{},U=async o=>{try{let t={message_id:o};await f.dispatch("deleteLiveChatMessage",t),f.dispatch("template_play_delete_file","Message deleted")}catch(t){console.error("Failed to delete message:",t),f.dispatch("template_play_error_file","Failed to delete message")}},I=async()=>{if(!M.value)return;const o={station_id:d.stationData.id,message:b.value.trim(),user_id:u.value.id,message_type:"user"};try{await f.dispatch("sendLiveChatMessage",o),b.value="",K(()=>{a()})}catch(t){console.error("Failed to send message:",t),f.dispatch("template_play_error_file","Failed to send message")}},R=()=>{u.value&&(S.value&&clearTimeout(S.value),v.value=!0,S.value=setTimeout(()=>{v.value=!1},2e3))},a=()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)},r=o=>{if(!o)return"";const t=new Date(o),s=new Date,D=s-t;if(D<36e5){const x=Math.floor(D/6e4);return x<1?"now":`${x}m`}return t.toDateString()===s.toDateString()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})},l=o=>{if(!o)return"A";const t=o.split(" ");return t.length>=2?(t[0].charAt(0)+t[1].charAt(0)).toUpperCase():o.charAt(0).toUpperCase()},j=o=>{if(!o)return"text-slate-400";const t=["text-blue-400","text-yellow-400","text-red-400","text-green-400","text-purple-400","text-cyan-400","text-pink-400","text-orange-400"];let s=0;for(let x=0;x<o.length;x++)s=(s<<5)-s+o.charCodeAt(x),s|=0;const D=Math.abs(s)%t.length;return t[D]},T=()=>{const o=Math.floor(Math.random()*50)+10,t=k.value.length;z.value=o+Math.floor(t/5)};return A(k,o=>{K(()=>{a()}),T()},{deep:!0}),G(()=>{a(),T()}),(o,t)=>(n(),i("div",de,[e("div",ce,[e("div",ue,[e("div",he,[t[1]||(t[1]=e("div",{class:"relative"},[e("div",{class:"w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse shadow-lg shadow-green-500/50"}),e("div",{class:"absolute inset-0 w-2.5 h-2.5 bg-green-500 rounded-full animate-ping opacity-30"})],-1)),e("div",null,[e("h3",pe,c(C.stationData.name),1),e("p",fe,c(C.stationData.frequency||C.stationData.description),1)])]),e("div",ge,c(C.stationData.listeners)+" online ",1)])]),e("div",{ref_key:"chatContainer",ref:g,class:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar"},[(n(!0),i(N,null,q(k.value,(s,D)=>{var x,B,V,W;return n(),i("div",{key:s.id,class:"message-item opacity-0 animate-fade-in group",style:J(`animation-delay: ${D*.05}s`)},[s.message_type==="system"?(n(),i("div",ve,[e("div",me,c(s.message),1)])):s.message_type==="moderator"?(n(),i("div",be,[e("div",xe,[t[2]||(t[2]=e("span",{class:"font-bold"},"MOD:",-1)),Z(" "+c(s.message),1)]),e("button",{onClick:X=>U(s.id),class:"absolute -right-6 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-red-600 hover:bg-red-700 text-white rounded-full p-1"},[y(w(O),{class:"h-3 w-3"})],8,_e)])):(n(),i("div",{key:2,class:_(["flex items-start gap-2 relative",m(s)?"flex-row-reverse":""])},[e("div",ye,[(x=s.user)!=null&&x.image_url?(n(),i("img",{key:0,src:s.user.image_url,alt:s.user.name,class:"w-full h-full object-cover"},null,8,we)):(n(),i("div",ke,c(l((B=s.user)==null?void 0:B.name)),1))]),e("div",{class:_(["flex-1 min-w-0",m(s)?"mr-2":""])},[e("div",{class:_(["rounded-lg px-3 py-2 backdrop-blur-sm",m(s)?"bg-gradient-to-r from-blue-600/80 to-purple-600/80 border border-blue-500/30 ml-8":"bg-slate-700/60 border border-slate-600/30"])},[e("div",{class:_(["flex items-center gap-2 mb-1",m(s)?"justify-end":""])},[e("span",{class:_(["text-xs font-medium",[j((V=s.user)==null?void 0:V.name),m(s)?"text-blue-200":""]])},c(m(s)?"You":((W=s.user)==null?void 0:W.name)||"Anonymous"),3),e("span",Ce,c(r(s.created_at)),1)],2),e("p",{class:_(["text-xs break-words leading-relaxed",m(s)?"text-white text-right":"text-slate-200"])},c(s.message),3)],2)],2),e("button",{onClick:X=>U(s.id),class:_(["opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-red-600 hover:bg-red-700 text-white rounded-full p-1",m(s)?"mr-2":"ml-2"])},[y(w(O),{class:"h-3 w-3"})],10,Se)],2))],4)}),128)),v.value?(n(),i("div",Me,t[3]||(t[3]=[ee('<div class="w-6 h-6 rounded-lg overflow-hidden flex-shrink-0 bg-slate-700" data-v-3b4ae6c6><div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-green-500 to-blue-500 text-white text-xs" data-v-3b4ae6c6> T </div></div><div class="flex items-center gap-2" data-v-3b4ae6c6><span class="font-medium" data-v-3b4ae6c6>Someone is typing</span><div class="typing-dots" data-v-3b4ae6c6><span class="dot bg-blue-500" data-v-3b4ae6c6></span><span class="dot bg-yellow-500" data-v-3b4ae6c6></span><span class="dot bg-red-500" data-v-3b4ae6c6></span></div></div>',2)]))):L("",!0),k.value.length===0?(n(),i("div",De,[e("div",$e,[y(w(Q),{class:"h-8 w-8 mx-auto mb-2 opacity-50"}),t[4]||(t[4]=e("p",null,"No messages yet. Be the first to start the conversation!",-1))])])):L("",!0)],512),e("div",Te,[e("div",Le,[te(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),placeholder:"Type a message...",rows:"1",class:"flex-1 bg-slate-700/70 border border-slate-600/50 rounded-lg py-3 px-4 text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 placeholder-slate-400 transition-all duration-300 resize-none min-h-[44px] max-h-32 leading-relaxed",onKeydown:[E(H(I,["exact","prevent"]),["enter"]),E(H(F,["shift","exact"]),["enter"])],onInput:$},null,40,Fe),[[se,b.value]]),e("button",{onClick:I,disabled:!M.value,class:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-purple-600 hover:to-red-600 text-white font-medium px-4 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100 text-sm self-end"},[y(w(re),{class:"h-4 w-4"})],8,Ue)]),e("div",Ie,[y(w(le),{class:"h-3 w-3 text-slate-500"}),e("span",je,c(M.value?"Press Enter to send, Shift+Enter for new line":"Login required to chat"),1)])])]))}},Re=Y(ze,[["__scopeId","data-v-3b4ae6c6"]]),Ae={class:""},Ne={class:"mb-8"},qe={class:"flex items-center gap-4 mb-2"},Be={class:"w-12 h-12 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg"},Ve={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"},We={key:0,class:"text-center py-16"},Ee={class:"w-24 h-24 bg-gray-200 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4"},He={class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"},Ke={class:"text-gray-600 dark:text-gray-400"},Oe={key:1,class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"},Pe=["disabled"],Ge={class:"fixed bottom-6 left-6 flex items-center gap-2 bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-lg border border-gray-200 dark:border-slate-700"},Qe={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},ot={__name:"LiveChats",setup(C){const d=P(),f=p(!1),g=p(!1);p(null);const b=p(!0),v=p(""),S=p("all"),z=p(1),k=h(()=>d.getters.stations||[]),u=h(()=>d.getters.liveChatmessages||[]);h(()=>d.getters.pagination);const M=h(()=>{let a=k.value;if(v.value.trim()){const r=v.value.toLowerCase();a=a.filter(l=>{var j,T,o;return((j=l.name)==null?void 0:j.toLowerCase().includes(r))||((T=l.description)==null?void 0:T.toLowerCase().includes(r))||((o=l.frequency)==null?void 0:o.toLowerCase().includes(r))})}if(S.value==="active"){const r=new Set(u.value.filter(l=>l.is_visible).map(l=>l.station_id));a=a.filter(l=>r.has(l.id))}return a});h(()=>new Set(u.value.map(r=>r.user_id)).size+Math.floor(Math.random()*100)+50),h(()=>k.value.filter(a=>a.status).length),h(()=>new Set(u.value.filter(r=>r.is_visible&&m(r.created_at)).map(r=>r.station_id)).size),h(()=>new Set(u.value.map(r=>r.station_id)).size),h(()=>{const a=new Date().toDateString();return u.value.filter(r=>new Date(r.created_at).toDateString()===a&&r.is_visible).length});const m=a=>{if(!a)return!1;const r=new Date(a),l=new Date(Date.now()-60*60*1e3);return r>l},$=async()=>{const a={per_page:50},r=z.value;try{f.value=!0,await d.dispatch("fetch_stations",{data:a,page:r})}catch(l){console.error("Failed to fetch stations:",l),d.dispatch("template_play_error_file","Failed to load stations")}finally{f.value=!1}},F=async()=>{try{await d.dispatch("fetchAllMessages")}catch(a){console.error("Failed to load messages:",a)}},U=async()=>{if(!g.value){g.value=!0;try{await Promise.all([$(),F()]),d.dispatch("template_play_success_file_no_msg")}catch(a){console.error("Failed to refresh:",a),d.dispatch("template_play_error_file","Failed to refresh data")}finally{g.value=!1}}},I=()=>{d.dispatch("connectWebSocket")},R=()=>{d.dispatch("disconnectWebSocket")};return A(()=>d.getters.connectionStatus,a=>{b.value=a==="connected"}),A(S,()=>{v.value=""}),G(async()=>{try{await $(),await F(),I()}catch(a){console.error("Failed to initialize live chats:",a),d.dispatch("utils/template_play_error_file","Failed to initialize live chats")}}),ae(()=>{R()}),(a,r)=>(n(),i("div",Ae,[e("div",Ne,[e("div",qe,[e("div",Be,[y(w(Q),{class:"h-6 w-6 text-white"})]),r[0]||(r[0]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"Live Chats"),e("p",{class:"text-gray-600 dark:text-gray-300"},"Real-time conversations across all Capital Radio stations")],-1))])]),e("div",Ve,[(n(!0),i(N,null,q(M.value,l=>(n(),oe(Re,{key:l.id,"station-data":l,class:"transform hover:scale-105 transition-all duration-300"},null,8,["station-data"]))),128))]),M.value.length===0?(n(),i("div",We,[e("div",Ee,[y(w(ne),{class:"h-12 w-12 text-gray-400 dark:text-slate-500"})]),e("h3",He,c(v.value?"No stations found":"No Active Stations"),1),e("p",Ke,c(v.value?"Try adjusting your search terms.":"Radio stations will appear here when they go live."),1),v.value?L("",!0):(n(),i("button",{key:0,onClick:$,class:"mt-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-purple-600 hover:to-red-600 text-white font-medium px-6 py-3 rounded-xl transition-all duration-300 transform hover:scale-105"}," Refresh Stations "))])):L("",!0),f.value?(n(),i("div",Oe,[(n(),i(N,null,q(6,l=>e("div",{key:l,class:"h-96 bg-gray-200 dark:bg-slate-800 rounded-2xl animate-pulse"})),64))])):L("",!0),e("button",{onClick:U,class:_(["fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-purple-600 hover:to-red-600 text-white rounded-full shadow-2xl hover:shadow-blue-500/25 transition-all duration-300 transform hover:scale-110 flex items-center justify-center group",{"animate-spin":g.value}]),disabled:g.value},[y(w(ie),{class:"h-6 w-6 group-hover:rotate-180 transition-transform duration-500"})],10,Pe),e("div",Ge,[e("div",{class:_(["w-2 h-2 rounded-full",b.value?"bg-green-500 animate-pulse":"bg-red-500"])},null,2),e("span",Qe,c(b.value?"Connected":"Disconnected"),1)])]))}};export{ot as default};
//# sourceMappingURL=LiveChats-DKakhtFz.js.map
