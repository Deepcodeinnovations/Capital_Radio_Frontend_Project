import{_ as Y,u as H,g as u,i as S,w as N,h as G,c as n,o as l,b as e,t as d,j as F,F as z,C as B,D as J,p as Z,d as _,k as y,n as b,a as ee,l as te,v as se,G as E,y as K,B as O,z as ae,s as oe}from"./index-tkd981dw.js";import{X as P}from"./x-DO1vW4_7.js";import{M as Q}from"./message-circle-Bgglqt4M.js";import{S as re}from"./send-Del25l1p.js";import{I as le}from"./info-DkGxyvYa.js";import{R as ne}from"./radio-CJnzQud5.js";import{R as ie}from"./refresh-cw-Cot4Z7dm.js";import"./createLucideIcon-CUtFUaqZ.js";const de={class:"bg-gradient-to-br from-slate-800/90 via-slate-900/90 to-black/90 backdrop-blur-xl rounded-2xl border border-slate-700/50 overflow-hidden flex flex-col shadow-2xl h-[75vh]"},ce={class:"px-4 py-3 bg-gradient-to-r from-slate-900/80 via-slate-800/80 to-slate-900/80 backdrop-blur-md border-b border-slate-700/50"},ue={class:"flex items-center justify-between"},he={class:"flex items-center gap-3"},pe={class:"font-bold text-sm text-white"},fe={class:"text-xs text-slate-400"},ge={class:"bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-600/30 text-blue-400 text-xs px-2 py-1 rounded-full font-medium"},ve={key:0,class:"text-center"},me={class:"text-xs text-slate-400 bg-slate-800/60 backdrop-blur-sm rounded-full px-3 py-1 border border-slate-600/30 inline-block"},be={key:1,class:"text-center relative"},xe={class:"text-xs text-yellow-400 bg-yellow-900/20 backdrop-blur-sm rounded-full px-3 py-1 border border-yellow-600/30 inline-block"},_e=["onClick"],ye={class:"w-7 h-7 rounded-lg overflow-hidden flex-shrink-0 bg-slate-700 border border-slate-600/50"},we=["src","alt"],ke={key:1,class:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-500 text-white text-xs font-bold"},Ce={class:"text-xs text-slate-500"},Me=["onClick"],Se={key:0,class:"flex items-center gap-2 text-slate-400 text-xs"},De={key:1,class:"text-center py-8"},$e={class:"text-slate-500 text-xs"},Te={class:"p-3 border-t border-slate-700/50 bg-gradient-to-r from-slate-900/80 via-slate-800/80 to-slate-900/80"},Le={class:"flex gap-2"},Fe=["onKeydown"],Ae=["disabled"],Re={class:"mt-2 flex items-center gap-1"},je={class:"text-xs text-slate-500"},Ie={__name:"LiveChatCard",props:{stationData:{type:Object,required:!0}},setup(k){const i=k,h=H(),f=u(null),g=u(""),w=u(!1),v=u(null),A=u(0),C=S(()=>(h.getters.livechatmessages||[]).filter(t=>t.station_id===i.stationData.id&&t.is_visible).sort((t,s)=>new Date(t.created_at)-new Date(s.created_at)).slice(-50)),x=S(()=>h.getters.authuser),D=S(()=>x.value&&x.value.id&&g.value.trim().length>0),p=a=>x.value&&a.user_id===x.value.id,$=a=>{const t=a.target;t.style.height="auto",t.style.height=Math.min(t.scrollHeight,128)+"px",I()},T=a=>{},R=async a=>{try{let t={message_id:a};await h.dispatch("deleteLiveChatMessage",t),h.dispatch("template_play_delete_file","Message deleted")}catch(t){console.error("Failed to delete message:",t),h.dispatch("template_play_error_file","Failed to delete message")}},j=async()=>{if(!D.value)return;const a={station_id:i.stationData.id,message:g.value.trim(),user_id:x.value.id,message_type:"user"};try{await h.dispatch("sendLiveChatMessage",a),g.value="",O(()=>{L()})}catch(t){console.error("Failed to send message:",t),h.dispatch("template_play_error_file","Failed to send message")}},I=()=>{x.value&&(v.value&&clearTimeout(v.value),w.value=!0,v.value=setTimeout(()=>{w.value=!1},2e3))},L=()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)},U=a=>{if(!a)return"";const t=new Date(a),s=new Date,M=s-t;if(M<36e5){const m=Math.floor(M/6e4);return m<1?"now":`${m}m`}return t.toDateString()===s.toDateString()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})},o=a=>{if(!a)return"A";const t=a.split(" ");return t.length>=2?(t[0].charAt(0)+t[1].charAt(0)).toUpperCase():a.charAt(0).toUpperCase()},c=a=>{if(!a)return"text-slate-400";const t=["text-blue-400","text-yellow-400","text-red-400","text-green-400","text-purple-400","text-cyan-400","text-pink-400","text-orange-400"];let s=0;for(let m=0;m<a.length;m++)s=(s<<5)-s+a.charCodeAt(m),s|=0;const M=Math.abs(s)%t.length;return t[M]},r=()=>{const a=Math.floor(Math.random()*50)+10,t=C.value.length;A.value=a+Math.floor(t/5)};return N(C,a=>{O(()=>{L()}),r()},{deep:!0}),G(()=>{L(),r()}),(a,t)=>(l(),n("div",de,[e("div",ce,[e("div",ue,[e("div",he,[t[1]||(t[1]=e("div",{class:"relative"},[e("div",{class:"w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse shadow-lg shadow-green-500/50"}),e("div",{class:"absolute inset-0 w-2.5 h-2.5 bg-green-500 rounded-full animate-ping opacity-30"})],-1)),e("div",null,[e("h3",pe,d(k.stationData.name),1),e("p",fe,d(k.stationData.frequency||k.stationData.description),1)])]),e("div",ge,d(k.stationData.listeners)+" online ",1)])]),e("div",{ref_key:"chatContainer",ref:f,class:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar"},[(l(!0),n(z,null,B(C.value,(s,M)=>{var m,V,q,W;return l(),n("div",{key:s.id,class:"message-item opacity-0 animate-fade-in group",style:J(`animation-delay: ${M*.05}s`)},[s.message_type==="system"?(l(),n("div",ve,[e("div",me,d(s.message),1)])):s.message_type==="moderator"?(l(),n("div",be,[e("div",xe,[t[2]||(t[2]=e("span",{class:"font-bold"},"MOD:",-1)),Z(" "+d(s.message),1)]),e("button",{onClick:X=>R(s.id),class:"absolute -right-6 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-red-600 hover:bg-red-700 text-white rounded-full p-1"},[_(y(P),{class:"h-3 w-3"})],8,_e)])):(l(),n("div",{key:2,class:b(["flex items-start gap-2 relative",p(s)?"flex-row-reverse":""])},[e("div",ye,[(m=s.user)!=null&&m.image_url?(l(),n("img",{key:0,src:s.user.image_url,alt:s.user.name,class:"w-full h-full object-cover"},null,8,we)):(l(),n("div",ke,d(o((V=s.user)==null?void 0:V.name)),1))]),e("div",{class:b(["flex-1 min-w-0",p(s)?"mr-2":""])},[e("div",{class:b(["rounded-lg px-3 py-2 backdrop-blur-sm",p(s)?"bg-gradient-to-r from-blue-600/80 to-purple-600/80 border border-blue-500/30 ml-8":"bg-slate-700/60 border border-slate-600/30"])},[e("div",{class:b(["flex items-center gap-2 mb-1",p(s)?"justify-end":""])},[e("span",{class:b(["text-xs font-medium",[c((q=s.user)==null?void 0:q.name),p(s)?"text-blue-200":""]])},d(p(s)?"You":((W=s.user)==null?void 0:W.name)||"Anonymous"),3),e("span",Ce,d(U(s.created_at)),1)],2),e("p",{class:b(["text-xs break-words leading-relaxed",p(s)?"text-white text-right":"text-slate-200"])},d(s.message),3)],2)],2),e("button",{onClick:X=>R(s.id),class:b(["opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-red-600 hover:bg-red-700 text-white rounded-full p-1",p(s)?"mr-2":"ml-2"])},[_(y(P),{class:"h-3 w-3"})],10,Me)],2))],4)}),128)),w.value?(l(),n("div",Se,t[3]||(t[3]=[ee('<div class="w-6 h-6 rounded-lg overflow-hidden flex-shrink-0 bg-slate-700" data-v-3b4ae6c6><div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-green-500 to-blue-500 text-white text-xs" data-v-3b4ae6c6> T </div></div><div class="flex items-center gap-2" data-v-3b4ae6c6><span class="font-medium" data-v-3b4ae6c6>Someone is typing</span><div class="typing-dots" data-v-3b4ae6c6><span class="dot bg-blue-500" data-v-3b4ae6c6></span><span class="dot bg-yellow-500" data-v-3b4ae6c6></span><span class="dot bg-red-500" data-v-3b4ae6c6></span></div></div>',2)]))):F("",!0),C.value.length===0?(l(),n("div",De,[e("div",$e,[_(y(Q),{class:"h-8 w-8 mx-auto mb-2 opacity-50"}),t[4]||(t[4]=e("p",null,"No messages yet. Be the first to start the conversation!",-1))])])):F("",!0)],512),e("div",Te,[e("div",Le,[te(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),placeholder:"Type a message...",rows:"1",class:"flex-1 bg-slate-700/70 border border-slate-600/50 rounded-lg py-3 px-4 text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 placeholder-slate-400 transition-all duration-300 resize-none min-h-[44px] max-h-32 leading-relaxed",onKeydown:[E(K(j,["exact","prevent"]),["enter"]),E(K(T,["shift","exact"]),["enter"])],onInput:$},null,40,Fe),[[se,g.value]]),e("button",{onClick:j,disabled:!D.value,class:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-purple-600 hover:to-red-600 text-white font-medium px-4 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100 text-sm self-end"},[_(y(re),{class:"h-4 w-4"})],8,Ae)]),e("div",Re,[_(y(le),{class:"h-3 w-3 text-slate-500"}),e("span",je,d(D.value?"Press Enter to send, Shift+Enter for new line":"Login required to chat"),1)])])]))}},Ue=Y(Ie,[["__scopeId","data-v-3b4ae6c6"]]),Ne={class:""},ze={class:"mb-8"},Be={class:"flex items-center gap-4 mb-2"},Ve={class:"w-12 h-12 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg"},qe={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"},We={key:0,class:"text-center py-16"},Ee={class:"w-24 h-24 bg-gray-200 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4"},Ke={class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"},Oe={class:"text-gray-600 dark:text-gray-400"},Pe={key:1,class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"},He=["disabled"],Ge={class:"fixed bottom-6 left-6 flex items-center gap-2 bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-lg border border-gray-200 dark:border-slate-700"},Qe={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},ot={__name:"LiveChats",setup(k){const i=H(),h=u(!1),f=u(!1),g=u(null),w=u(!0),v=u(""),A=u("all"),C=u(1),x=S(()=>i.getters.stations||[]),D=S(()=>i.getters.liveChatmessages||[]),p=S(()=>{let o=x.value;if(v.value.trim()){const c=v.value.toLowerCase();o=o.filter(r=>{var a,t,s;return((a=r.name)==null?void 0:a.toLowerCase().includes(c))||((t=r.description)==null?void 0:t.toLowerCase().includes(c))||((s=r.frequency)==null?void 0:s.toLowerCase().includes(c))})}if(A.value==="active"){const c=new Set(D.value.filter(r=>r.is_visible).map(r=>r.station_id));o=o.filter(r=>c.has(r.id))}return o}),$=async()=>{const o={per_page:50},c=C.value;try{h.value=!0,await i.dispatch("fetch_stations",{data:o,page:c})}catch(r){console.error("Failed to fetch stations:",r),i.dispatch("template_play_error_file","Failed to load stations")}finally{h.value=!1}},T=async()=>{try{await i.dispatch("fetchAllMessages")}catch(o){console.error("Failed to load messages:",o)}},R=()=>{g.value=setInterval(async()=>{try{await T()}catch(o){console.error("Auto-refresh messages failed:",o)}},4e3)},j=()=>{g.value&&(clearInterval(g.value),g.value=null)},I=async()=>{if(!f.value){f.value=!0;try{await Promise.all([$(),T()]),i.dispatch("template_play_success_file_no_msg")}catch(o){console.error("Failed to refresh:",o),i.dispatch("template_play_error_file","Failed to refresh data")}finally{f.value=!1}}},L=()=>{i.dispatch("connectWebSocket")},U=()=>{i.dispatch("disconnectWebSocket")};return N(()=>i.getters.connectionStatus,o=>{w.value=o==="connected"}),N(A,()=>{v.value=""}),G(async()=>{try{await $(),await T(),L(),R()}catch(o){console.error("Failed to initialize live chats:",o),i.dispatch("template_play_error_file","Failed to initialize live chats")}}),ae(()=>{j(),U()}),(o,c)=>(l(),n("div",Ne,[e("div",ze,[e("div",Be,[e("div",Ve,[_(y(Q),{class:"h-6 w-6 text-white"})]),c[0]||(c[0]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"Live Chats"),e("p",{class:"text-gray-600 dark:text-gray-300"},"Real-time conversations across all Capital Radio stations")],-1))])]),e("div",qe,[(l(!0),n(z,null,B(p.value,r=>(l(),oe(Ue,{key:r.id,"station-data":r,class:"transform hover:scale-105 transition-all duration-300"},null,8,["station-data"]))),128))]),p.value.length===0?(l(),n("div",We,[e("div",Ee,[_(y(ne),{class:"h-12 w-12 text-gray-400 dark:text-slate-500"})]),e("h3",Ke,d(v.value?"No stations found":"No Active Stations"),1),e("p",Oe,d(v.value?"Try adjusting your search terms.":"Radio stations will appear here when they go live."),1),v.value?F("",!0):(l(),n("button",{key:0,onClick:$,class:"mt-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-purple-600 hover:to-red-600 text-white font-medium px-6 py-3 rounded-xl transition-all duration-300 transform hover:scale-105"}," Refresh Stations "))])):F("",!0),h.value?(l(),n("div",Pe,[(l(),n(z,null,B(6,r=>e("div",{key:r,class:"h-96 bg-gray-200 dark:bg-slate-800 rounded-2xl animate-pulse"})),64))])):F("",!0),e("button",{onClick:I,class:b(["fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-purple-600 hover:to-red-600 text-white rounded-full shadow-2xl hover:shadow-blue-500/25 transition-all duration-300 transform hover:scale-110 flex items-center justify-center group",{"animate-spin":f.value}]),disabled:f.value},[_(y(ie),{class:"h-6 w-6 group-hover:rotate-180 transition-transform duration-500"})],10,He),e("div",Ge,[e("div",{class:b(["w-2 h-2 rounded-full",w.value?"bg-green-500 animate-pulse":"bg-red-500"])},null,2),e("span",Qe,d(w.value?"Connected":"Disconnected"),1)])]))}};export{ot as default};
//# sourceMappingURL=LiveChats-C8ZFqTTw.js.map
