import{e as O,A as W,u as G,g as u,f as J,i as L,h as Q,B as g,z as X,r as Z,c as i,o,b as r,j as S,a as ee,d as w,k as m,p as x,t as _,y as te,F as re,C as se,l as ae,v as oe,n as le,s as A,m as ne}from"./index-xh6Kq0Kr.js";import{S as M}from"./shield-check-CAUDtfDS.js";import{C as ie}from"./circle-check-big-D8E6kRsW.js";import{C as de}from"./circle-alert-k5NeBr3Z.js";import{L as N}from"./loader-B-oRPTg4.js";import{R as ue}from"./rotate-ccw-0ZfXvYuX.js";import{A as ce}from"./arrow-left-jJzQjst-.js";import"./createLucideIcon-BvNgPl9c.js";const pe={class:"max-w-md w-full space-y-6 bg-white/95 dark:bg-slate-800/95 backdrop-blur-sm p-10 rounded-xl shadow-2xl border border-purple-200 dark:border-slate-700"},me={class:"text-center"},fe={class:"mx-auto w-12 h-12 bg-gradient-to-r from-purple-600 to-orange-500 rounded-full flex items-center justify-center mb-4"},ve={class:"text-gray-600 dark:text-gray-300 mt-1 max-w-sm mx-auto"},ge={class:"text-purple-600 dark:text-purple-400"},xe={key:0,class:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4"},ye={class:"flex items-start"},he={key:1,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4"},ke={class:"flex items-center"},be={class:"text-sm text-red-700 dark:text-red-400"},we={class:"flex justify-center space-x-3"},_e=["onUpdate:modelValue","onInput","onKeydown","onPaste"],Ce={class:"mt-3 text-xs text-gray-500 dark:text-gray-400 text-center"},Ve=["disabled"],Ie={key:3,class:"space-y-4"},Re={class:"text-center"},Pe=["disabled"],Se={key:2},Ae={key:3},Be={key:4},De={class:"text-center space-y-4"},Fe={__name:"VerifyOTP",setup(Le){const C=O(),D=W(),V=G(),f=u(D.query.email||""),T=u(D.query.purpose||"password_reset"),n=J(["","","","","",""]),c=u([]),y=u(!1),h=u(!1),I=u(!1),p=u(""),v=u(0),R=u(600);let k=null,b=null;const j=L(()=>{if(!f.value)return"";const[t,e]=f.value.split("@");return`${t.charAt(0)+"*".repeat(t.length-2)+t.charAt(t.length-1)}@${e}`}),P=L(()=>n.every(t=>t.length===1)),E=(t,e)=>{t&&(c.value[e]=t)},U=(t,e)=>{const s=t.target.value.replace(/[^0-9]/g,"");n[e]=s,s&&e<5&&g(()=>{var l;(l=c.value[e+1])==null||l.focus()}),P.value&&g(()=>{B()})},q=(t,e)=>{var s,l,a;t.key==="Backspace"&&!n[e]&&e>0?(s=c.value[e-1])==null||s.focus():t.key==="ArrowLeft"&&e>0?(l=c.value[e-1])==null||l.focus():t.key==="ArrowRight"&&e<5&&((a=c.value[e+1])==null||a.focus())},$=(t,e)=>{t.preventDefault();const s=t.clipboardData.getData("text").replace(/[^0-9]/g,"");for(let a=0;a<Math.min(s.length,6-e);a++)n[e+a]=s[a];const l=Math.min(e+s.length-1,5);g(()=>{var a;(a=c.value[l])==null||a.focus()}),P.value&&g(()=>{B()})},B=async()=>{if(P.value)try{y.value=!0,p.value="";const t=n.join(""),e=await V.dispatch("verifyResetCode",{code:t,email:f.value});I.value=!0,setTimeout(()=>{var s,l;T.value==="password_reset"?C.push({name:"NewPassword",query:{token:t,email:f.value,admin_id:(l=(s=e.data)==null?void 0:s.data)==null?void 0:l.admin_id}}):C.push({name:"Login"})},2e3)}catch(t){console.error("Verification error:",t),p.value=V.getters.error||t.message||"Invalid verification code. Please try again.",n.forEach((e,s)=>{n[s]=""}),g(()=>{var e;(e=c.value[0])==null||e.focus()})}finally{y.value=!1}},F=async()=>{try{h.value=!0,p.value="",await V.dispatch("forgotAdminPassword",f.value),z(),R.value=600}catch(t){console.error("Resend error:",t),p.value=V.getters.error||t.message||"Failed to resend code. Please try again."}finally{h.value=!1}},K=()=>{C.push({name:"ResetPassword"})},z=()=>{v.value=60,k=setInterval(()=>{v.value--,v.value<=0&&(clearInterval(k),k=null)},1e3)},Y=()=>{b=setInterval(()=>{R.value--,R.value<=0&&(clearInterval(b),b=null,p.value="Verification code has expired. Please request a new one.")},1e3)},H=t=>{const e=Math.floor(t/60),s=t%60;return`${e}:${s.toString().padStart(2,"0")}`};return Q(()=>{g(()=>{var t;(t=c.value[0])==null||t.focus()}),Y(),f.value||C.push({name:"ResetPassword"})}),X(()=>{k&&clearInterval(k),b&&clearInterval(b)}),(t,e)=>{const s=Z("router-link");return o(),i("div",pe,[r("div",me,[r("div",fe,[w(m(M),{class:"w-6 h-6 text-white"})]),e[2]||(e[2]=r("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Verify Your Identity",-1)),r("p",ve,[e[0]||(e[0]=x(" We've sent a verification code to ")),r("strong",ge,_(j.value),1),e[1]||(e[1]=x(". Enter the code below to continue. "))])]),I.value?(o(),i("div",xe,[r("div",ye,[w(m(ie),{class:"h-5 w-5 text-green-500 mr-3 flex-shrink-0 mt-0.5"}),e[3]||(e[3]=r("div",null,[r("h4",{class:"font-medium text-green-900 dark:text-green-200 mb-1"},"Verification successful!"),r("p",{class:"text-sm text-green-700 dark:text-green-300"}," Your identity has been verified. Redirecting you now... ")],-1))])])):S("",!0),p.value?(o(),i("div",he,[r("div",ke,[w(m(de),{class:"h-5 w-5 text-red-500 mr-2"}),r("span",be,_(p.value),1)])])):S("",!0),I.value?S("",!0):(o(),i("form",{key:2,class:"space-y-6",onSubmit:te(B,["prevent"])},[r("div",null,[e[4]||(e[4]=r("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 text-center"}," Enter Verification Code ",-1)),r("div",we,[(o(!0),i(re,null,se(n,(l,a)=>ae((o(),i("input",{key:a,ref_for:!0,ref:d=>E(d,a),"onUpdate:modelValue":d=>n[a]=d,type:"text",maxlength:"1",class:le(["w-12 h-12 text-center text-xl font-bold border border-gray-300 dark:border-slate-600 rounded-lg shadow-sm bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200",{"border-red-300 focus:ring-red-500":p.value}]),onInput:d=>U(d,a),onKeydown:d=>q(d,a),onPaste:d=>$(d,a)},null,42,_e)),[[oe,n[a]]])),128))]),r("p",Ce," Code expires in "+_(H(R.value)),1)]),r("button",{type:"submit",disabled:y.value||!P.value,class:"relative w-full flex justify-center items-center py-3 px-4 border border-transparent text-sm font-semibold rounded-lg text-white bg-gradient-to-r from-purple-600 to-orange-500 hover:from-purple-700 hover:to-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"},[y.value?(o(),A(m(N),{key:0,class:"w-5 h-5 mr-2 animate-spin"})):(o(),A(m(M),{key:1,class:"w-5 h-5 mr-2"})),x(" "+_(y.value?"Verifying...":"Verify Code"),1)],8,Ve)],32)),I.value?S("",!0):(o(),i("div",Ie,[r("div",Re,[e[5]||(e[5]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-4"},"Didn't receive the code?",-1)),r("button",{onClick:F,disabled:h.value||v.value>0,class:"inline-flex items-center px-4 py-2 text-sm font-medium text-purple-600 hover:text-purple-500 dark:text-purple-400 dark:hover:text-purple-300 disabled:text-gray-400 dark:disabled:text-gray-500 transition-colors disabled:cursor-not-allowed"},[h.value?(o(),A(m(N),{key:0,class:"animate-spin h-4 w-4 mr-2"})):(o(),A(m(ue),{key:1,class:"w-4 h-4 mr-2"})),v.value>0?(o(),i("span",Se," Resend in "+_(v.value)+"s ",1)):h.value?(o(),i("span",Ae," Sending... ")):(o(),i("span",Be," Resend code "))],8,Pe)]),e[6]||(e[6]=r("div",{class:"text-center"},[r("details",{class:"text-left"},[r("summary",{class:"text-sm text-gray-600 dark:text-gray-400 cursor-pointer hover:text-gray-800 dark:hover:text-gray-200 transition-colors font-medium"}," Having trouble? View help options "),r("div",{class:"mt-3 text-xs text-gray-500 dark:text-gray-400 space-y-2 bg-gray-50 dark:bg-slate-700/50 rounded-lg p-4"},[r("p",null,"• Check your spam or junk folder"),r("p",null,"• Make sure you entered the correct email address"),r("p",null,"• Codes expire after 10 minutes"),r("p",null,"• Contact support if you continue having issues")])])],-1))])),e[9]||(e[9]=ee('<div class="mt-8 mb-6"><div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200 dark:border-slate-600"></div></div><div class="relative flex justify-center text-sm"><span class="px-4 bg-white dark:bg-slate-800 text-gray-500 dark:text-gray-400">Need to change email?</span></div></div></div>',1)),r("div",De,[r("button",{onClick:K,class:"inline-flex items-center text-purple-600 hover:text-purple-500 dark:text-purple-400 dark:hover:text-purple-300 transition-colors font-medium text-sm"},[w(m(ce),{class:"w-4 h-4 mr-2"}),e[7]||(e[7]=x(" Use different email "))]),r("div",null,[w(s,{to:{name:"Login"},class:"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors"},{default:ne(()=>e[8]||(e[8]=[x(" Back to sign in ")])),_:1,__:[8]})])]),e[10]||(e[10]=r("div",{class:"mt-6 text-center"},[r("p",{class:"text-xs text-gray-500 dark:text-gray-400"},[x(" Need help? "),r("a",{href:"mailto:support@capitalradio.co.ug",class:"text-purple-600 hover:text-purple-500 dark:text-purple-400 dark:hover:text-purple-300 transition-colors font-medium"}," Contact support ")])],-1))])}}};export{Fe as default};
//# sourceMappingURL=VerifyOTP-Dv5angTy.js.map
